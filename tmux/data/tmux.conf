# LDVSoft Environment :: Tmux
# Target version: 3.1

# Server options
set-option -s default-terminal "tmux-256color"
set-option -s escape-time 100
set-option -s focus-events on
set-option -sF history-file "#{?XDG_CONFIG_HOME,#{XDG_CONFIG_HOME},~/.config}/tmux/history"
set-option -s set-clipboard on
set-option -sa terminal-overrides "xterm-256color:Tc"
# user-keys can be cool

# Global session options
#   A given session can override those.
set-option -g @user-name '‹user›'
run-shell -b { tmux set-option -g @user-name $(whoami) }
set-option -g base-index 1
set-option -g lock-command "vlock"
set-option -g mouse on
set-option -g prefix C-a
set-option -g repeat-time 100
set-option -g set-titles on
set-option -g set-titles-string '#T :: #{@user-name}@#H #S / #I #W / #P'
set-option -g status on
# I rebuild default status format:
#  There is a major assumption that noop-styles are empty strings and not `default`.
#  To achieve this, we are using a separate set of custom style options.
set-option -g status-format[0] ""
#   Left status: almost intact, different trimming symbol
set-option -ga status-format[0] "#[align=left range=left #{status-left-style}]#[push-default]"
set-option -ga status-format[0]   "#{T;=/#{status-left-length}/…:status-left}"
set-option -ga status-format[0] "#[pop-default]#[norange default]"
#   Windows list. Styling: different symbols for shortened lists.
set-option -ga status-format[0] "#[list=on align=#{status-justify}]#[list=left-marker]«#[list=right-marker]»#[list=on]"
set-option -ga status-format[0] "#{W:" # }
#     Windows list body: style if not current
set-option -ga status-format[0]   "#[range=window|#{window_index}" # ]
set-option -ga status-format[0]     " #{?window_active," # }
set-option -ga status-format[0]       "list=focus #{window-status-current-style}"
set-option -ga status-format[0]     ","
set-option -ga status-format[0]       "#{window-status-style}"
set-option -ga status-format[0]     "}"
set-option -ga status-format[0]     " #{?window_last_flag,#{window-status-last-style},}"
set-option -ga status-format[0]     " #{?window_bell_flag,#{window-status-bell-style},}"
set-option -ga status-format[0]     " #{?#{||:#{window_activity_flag},#{window_silence_flag}},#{window-status-activity-style},}"
set-option -ga status-format[0]   "]"
#     Windows list body:
set-option -ga status-format[0]   "#{T:window-status-format}"
set-option -ga status-format[0]   "#[norange default list=on]"
set-option -ga status-format[0]   "#{?window_end_flag,,#{T:window-status-separator}}"
set-option -ga status-format[0] "}"
set-option -ga status-format[0] "#[nolist]"
#   Right status: almost intact, different trimming symbol
set-option -ga status-format[0] "#[align=right range=right #{status-right-style}]#[push-default]"
set-option -ga status-format[0]   "#{T;=/#{status-right-length}/…:status-right}"
set-option -ga status-format[0] "#[pop-default]#[norange default]"
#   And that's all!
set-option -g status-justify centre
set-option -g status-keys vi
set-option -g status-left "#[fg=brightgreen]#{@user-name}#[fg=green nobold]@#[fg=brightgreen]#H#[fg=brightwhite] #S #{?client_prefix,#[bold][*]#[nobold],#[fg=black][ ]}"
set-option -g status-left-style ''
set-option -g status-left-length 35
set-option -g status-right "#(date +'%a #[fg=brightwhite]%d#[fg=white].#[fg=brightwhite]%m#[fg=white] %b.#[fg=brightwhite]%Y %H#[fg=white]:#[fg=brightwhite]%M#[fg=white] %Z #[fg=brightblack]%:::z')"
set-option -g status-right-style 'fg=white'
set-option -g status-right-length 35
set-option -g status-style "fg=white"
set-option -g window-status-separator '#{?#{>=:7,#{session_windows}}, • ,•}'
# Think about update-environment
set-option -g visual-activity both
set-option -g visual-silence both

# Global window options
#   A given window can override those.
# automatic-rename-format?
# Tmux 3.1 will have push-pop defaults.
set-option -wg  clock-mode-colour white
set-option -wg  mode-keys vi
set-option -wg  pane-base-index 1
set-option -wg  window-status-activity-style 'fg=brightyellow bg=#202005'
set-option -wg  window-status-bell-style 'underscore'
set-option -wg  window-status-current-style 'fg=brightgreen bg=#052005'
set-option -wg  window-status-last-style 'bg=#050520'
set-option -wg  window-status-format '#I #{?automatic-rename,#[italics],}#W#{?automatic-rename,#[noitalics],}#{?#F,#F, }'
set-option -wg  window-status-style 'fg=brightblue bg=#050505'
set-option -wg  xterm-keys on

# Global pane options
#   A window defines those for all it's panes,
#     so a given window can override those.
#   Also, a given pane can override even those.
set-option -wg allow-rename on
set-option -wg alternate-screen on

bind-key c {
	new-window -e "LDVSOFT_TMUX_CD=#{pane_path}"
}
bind-key | {
	split-window -h -e "LDVSOFT_TMUX_CD=#{pane_path}"
}
bind-key - {
	split-window -v -e "LDVSOFT_TMUX_CD=#{pane_path}"
}
bind-key C-b { send-prefix ; send-prefix }
bind-key C-a { send-prefix }
bind-key R {
	source '@@DATADIR_PRIVATE@@/tmux.conf'
	display 'Config reloaded.'
}
unbind-key %
unbind-key '"'